<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ viewport –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <title>–°–ø–æ—Ä –º–µ–∂–¥—É –¥–≤—É–º—è –∞–≥–µ–Ω—Ç–∞–º–∏ –ò–ò</title>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ Roboto –æ—Ç Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ CSS –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è body */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ h1 */
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ GPU */
        #gpu-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #lamp {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: gray;
        }
        #gpu-message {
            font-size: 16px;
            color: #333;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã –¥–∏–∞–ª–æ–≥–∞ */
        #dialog-form {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            transition: transform 0.3s ease;
        }
        #dialog-form:hover {
            transform: translateY(-5px);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ—Ç–æ–∫ –∏ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
        label {
            font-weight: 500;
            color: #444;
        }

        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            border-color: #667eea;
            outline: none;
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è textarea */
        textarea {
            height: 200px;  /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π */
            resize: vertical;  /* –†–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π resize */
            overflow-y: auto;  /* –°–∫—Ä–æ–ª–ª–∏–Ω–≥ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            word-wrap: break-word;  /* –ü–µ—Ä–µ–Ω–æ—Å —Å–ª–æ–≤ */
        }

        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è —Ç–µ–º—ã */
        #topic {
            height: 100px;  /* –ù–∞—á–∞–ª—å–Ω–∞—è –º–µ–Ω—å—à–∞—è –≤—ã—Å–æ—Ç–∞ */
            resize: vertical;  /* –†–∞–∑—Ä–µ—à–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ */
            overflow-y: auto;  /* –°–∫—Ä–æ–ª–ª–∏–Ω–≥ –≤–Ω—É—Ç—Ä–∏, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–Ω–æ–ø–æ–∫ */
        .button-container {
            display: flex;
            gap: 10px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }
        button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–∏–∞–ª–æ–≥–∞ */
        .dialog-container {
            height: 500px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #667eea;
            border-radius: 15px;
            font-size: 16px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 600px;
            -webkit-overflow-scrolling: touch;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ –¥–∏–∞–ª–æ–≥–∞ */
        .dialog-line {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(248, 249, 250, 0.8);
            border-radius: 10px;
            border-left: 5px solid #667eea;
            color: #000 !important;
            word-wrap: break-word;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è */
        .dialog-line-waiting {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(240, 240, 240, 0.8);
            border-radius: 10px;
            border-left: 5px solid #ff9800;
            color: #666 !important;
            font-style: italic;
            display: flex;
            align-items: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ (SVG) */
        .spinner-svg {
            width: 40px;
            height: 40px;
            flex-shrink: 0;
            margin-left: 10px;
        }
        .path {
            fill: none;
            stroke: #ff9800;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-dasharray: 62.8 62.8; /* –ü–æ–ª–æ–≤–∏–Ω–∞ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ (–¥–ª—è r=20: ~126 –ø–æ–ª–Ω–∞) –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –≤—Ä–∞—â–∞—é—â–µ–π—Å—è –ø–æ–ª—É–∫—Ä—É–≥–∏ */
            animation: spin 1s linear infinite;
            transform-origin: 25px 25px;
            will-change: transform;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .counter {
            fill: #333; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ —Å—á–µ—Ç—á–∏–∫–∞ */
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
        .progress {
            width: 100%;
            max-width: 600px;
            background: rgba(240, 240, 240, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 10px;
            width: 0%;
            border-radius: 10px;
            transition: width 0.5s ease, background 0.5s ease;
            background: linear-gradient(135deg, #ff5722 0%, #e91e63 100%); /* –ù–∞—á–∞–ª—å–Ω—ã–π —Ü–≤–µ—Ç (–∫—Ä–∞—Å–Ω–æ–≤–∞—Ç—ã–π) */
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.3) 10px,
                rgba(255, 255, 255, 0.3) 20px
            );
            background-size: 20px 20px;
            animation:
                progress-stripes 1s linear infinite,  /* –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ–ª–æ—Å */
                pulse 0.5s ease-in-out infinite;     /* –ü—É–ª—å—Å–∞—Ü–∏—è (–Ω–æ–≤–æ–µ) */
        }
        @keyframes progress-stripes {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 0%; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }  /* –õ–µ–≥–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø—É–ª—å—Å–∞—Ü–∏–∏ */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è */
        #success-message {
            display: none;
            color: #28a745;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin: 10px 0;
            width: 100%;
            max-width: 600px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ */
        #stop-message {
            display: none;
            color: #dc3545;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin: 10px 0;
            width: 100%;
            max-width: 600px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ—à–∏–±–∫–∏ */
        #error-message {
            display: none;
            color: #ff5722; /* –û—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—à–∏–±–∫–∏ */
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            margin: 10px 0;
            width: 100%;
            max-width: 600px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (—Å–ø–∏—Å–æ–∫) */
        ol {
            color: #fff;
            padding-left: 20px;
            width: 100%;
            max-width: 600px;
        }
        ol li {
            margin-bottom: 5px;
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—â–∏—Ö —Ç–µ–º–Ω—ã–π —Ä–µ–∂–∏–º */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                color: #ecf0f1;
            }
            #dialog-form, .dialog-container, #success-message, #stop-message, #gpu-indicator, #error-message {
                background: rgba(28, 28, 28, 0.9);
                color: #ecf0f1;
            }
            .dialog-line {
                background: rgba(45, 45, 45, 0.8);
                color: #ecf0f1 !important;
            }
            .dialog-line-waiting {
                background: rgba(58, 58, 58, 0.8);
                color: #ccc !important;
            }
            label, ol, #gpu-message, #error-message {
                color: #ecf0f1;
            }
            .counter {
                fill: #ecf0f1; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ */
            }
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            #dialog-form, .dialog-container, .progress, #success-message, #stop-message, #gpu-indicator, #error-message {
                max-width: 95%;
                padding: 20px;
            }
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Socket.IO –¥–ª—è WebSocket –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
</head>
<body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <h1>–°–ø–æ—Ä –º–µ–∂–¥—É –¥–≤—É–º—è –∞–≥–µ–Ω—Ç–∞–º–∏ AI</h1>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ GPU -->
    <div id="gpu-indicator">
        <div id="lamp"></div>
        <span id="gpu-message">–ü—Ä–æ–≤–µ—Ä–∫–∞ GPU...</span>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∏–∞–ª–æ–≥–∞ -->
    <form id="dialog-form">
        <!-- –ü–æ–ª–µ –¥–ª—è —Ç–µ–º—ã –¥–∏–∞–ª–æ–≥–∞ -->
        <div>
            <label for="topic">–¢–µ–º–∞ –¥–∏–∞–ª–æ–≥–∞:</label>
            <textarea id="topic" name="topic">–°–ø–æ—Ä –æ —Ñ–æ—Ä–º–µ –ó–µ–º–ª–∏</textarea>
        </div>

        <!-- –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ —Ä–æ–ª–∏ 1 -->
        <div>
            <label for="role1_name">–ò–º—è —Ä–æ–ª–∏ 1 (–Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∏–∞–ª–æ–≥):</label>
            <input type="text" id="role1_name" name="role1_name" value="–£—á–µ–Ω—ã–π">
        </div>

        <!-- –ü–æ–ª–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ä–æ–ª–∏ 1 -->
        <div>
            <label for="role1_description">–û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏ —Ä–æ–ª–∏ 1:</label>
            <textarea id="role1_description" name="role1_description">–¢—ã –∏–∑–≤–µ—Å—Ç–Ω—ã–π —É—á–µ–Ω—ã–π —Ñ–∏–∑–∏–∫ –∏ –≥–æ—Ç–æ–≤ —Ä–µ—à–∞—Ç—å –ª—é–±—ã–µ –∑–∞–¥–∞—á–∏. –ü—Ä–∏–≤–æ–¥–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ –ø–æ–ª—å–∑—É —Å–≤–æ–µ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è. –ù–∞ –≤—Å–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–∏–≤–æ–¥–∏ —Å–≤–æ–∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–ª–∏ –ø—Ä–∏–º–µ—Ä—ã. –¢—ã –≤—Å–ø—ã–ª—å—á–∏–≤ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª–µ–Ω.</textarea>
        </div>

        <!-- –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ —Ä–æ–ª–∏ 2 -->
        <div>
            <label for="role2_name">–ò–º—è —Ä–æ–ª–∏ 2:</label>
            <input type="text" id="role2_name" name="role2_name" value="–°—Ç—É–¥–µ–Ω—Ç">
        </div>

        <!-- –ü–æ–ª–µ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ä–æ–ª–∏ 2 -->
        <div>
            <label for="role2_description">–û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏ —Ä–æ–ª–∏ 2:</label>
            <textarea id="role2_description" name="role2_description">–¢—ã –≤–µ—Å–µ–ª—ã–π —Å—Ç—É–¥–µ–Ω—Ç —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞. –ò —Ç—ã –ª—é–±–∏—à—å —Å–ø–æ—Ä–∏—Ç—å. –£–±–µ–¥–∏ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞, —á—Ç–æ —Ç–≤–æ—è —Ç–æ—á–∫–∞ –∑—Ä–µ–Ω–∏—è –≤–µ—Ä–Ω–∞. –ü—Ä–∏–≤–æ–¥–∏ –ø—Ä–∏–º–µ—Ä—ã –∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ —Ñ–∏–∑–∏–∫–∏ –∏ –¥—Ä—É–≥–∏—Ö –Ω–∞—É–∫. –®—É—Ç–∏ –µ—Å–ª–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –Ω–µ —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è.</textarea>
        </div>

        <!-- –ü–æ–ª–µ –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤ –¥–∏–∞–ª–æ–≥–∞ -->
        <div>
            <label for="num_steps">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –¥–∏–∞–ª–æ–≥–∞:</label>
            <input type="number" id="num_steps" name="num_steps" min="1" max="30" value="7">
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∏–∞–ª–æ–≥–∞ -->
        <div class="button-container">
            <button type="submit">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–ª–æ–≥</button>
            <button type="button" id="stop-button" disabled>–°—Ç–æ–ø</button>
        </div>
    </form>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="error-message">‚ùå –û—à–∏–±–∫–∞: –°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ ...</div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞ -->
    <div id="dialog-container" class="dialog-container"></div>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
    <div class="progress">
        <div id="progress-bar" class="progress-bar"></div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–∏–∞–ª–æ–≥–∞ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="success-message">‚úÖ –î–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à–µ–Ω! –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ <span id="steps-count"></span> —Ä–µ–ø–ª–∏–∫.</div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–∏–∞–ª–æ–≥–∞ (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="stop-message">üõë –î–∏–∞–ª–æ–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!</div>

    <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
    <hr style="width: 100%; max-width: 600px; border-color: rgba(255,255,255,0.3);">

    <!-- –¢–µ–∫—Å—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
    <p style="color: #fff; text-align: center; width: 100%; max-width: 600px;"><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong></p>
    <!-- –ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π -->
    <ol>
        <li>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–º—É –¥–∏–∞–ª–æ–≥–∞ –∏ –æ–ø–∏—Å–∞–Ω–∏—è —Ä–æ–ª–µ–π</li>
        <li>–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ (—Ä–µ–ø–ª–∏–∫)</li>
        <li>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–ª–æ–≥"</li>
        <li>–°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–∫–Ω–µ –≤—ã—à–µ</li>
    </ol>

    <!-- JavaScript –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π –∏ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Socket.IO
        const socket = io();

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM
        const form = document.getElementById('dialog-form');
        const dialogContainer = document.getElementById('dialog-container');
        const progressBar = document.getElementById('progress-bar');
        const successMessage = document.getElementById('success-message');
        const stepsCount = document.getElementById('steps-count');
        const stopMessage = document.getElementById('stop-message');
        const errorMessage = document.getElementById('error-message');
        const stopButton = document.getElementById('stop-button');
        const lamp = document.getElementById('lamp');
        const gpuMessage = document.getElementById('gpu-message');

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const numStepsInput = document.getElementById('num_steps');
        let totalSteps = parseInt(numStepsInput.value);
        let currentStep = null;
        let currentSpeaker = null;
        let currentTimer = null; // –¢–∞–π–º–µ—Ä –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–µ–∫—É–Ω–¥
        let counter = 0; // –°—á–µ—Ç—á–∏–∫ —Å–µ–∫—É–Ω–¥

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–∏–∑—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–∏–∞–ª–æ–≥–∞
        function isAtBottom() {
            return dialogContainer.scrollTop + dialogContainer.clientHeight >= dialogContainer.scrollHeight - 10; // –ú–∞–ª–µ–Ω—å–∫–∏–π –ø–æ—Ä–æ–≥ –≤ 10px
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            dialogContainer.innerHTML = '';
            progressBar.style.width = '0%';
            successMessage.style.display = 'none';
            stopMessage.style.display = 'none';
            errorMessage.style.display = 'none';  // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
            currentStep = null;  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
            currentSpeaker = null;
            totalSteps = parseInt(numStepsInput.value);
            clearInterval(currentTimer); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å
            currentTimer = null;
            counter = 0;
            const data = new FormData(form);
            const jsonData = {
                topic: data.get('topic'),
                role1_name: data.get('role1_name'),
                role1_description: data.get('role1_description'),
                role2_name: data.get('role2_name'),
                role2_description: data.get('role2_description'),
                num_steps: data.get('num_steps')
            };
            socket.emit('start_dialog', jsonData);
            stopButton.disabled = false;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ —Å—Ç–æ–ø
        stopButton.addEventListener('click', function() {
            socket.emit('stop_dialog');
            stopButton.disabled = true;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'waiting' –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('waiting', function(data) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥ –∏ —Å–ø–∏–∫–µ—Ä–∞
            currentStep = data.step;
            currentSpeaker = data.speaker;

            clearInterval(currentTimer); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            counter = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫

            const waitingDiv = document.createElement('div');
            waitingDiv.className = 'dialog-line-waiting';

            // –¢–µ–∫—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å
            const textPart = document.createTextNode(`${data.step}. ${data.speaker}: `);
            waitingDiv.appendChild(textPart);

            // SVG —Å–ø–∏–Ω–Ω–µ—Ä
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.classList.add('spinner-svg');
            svg.setAttribute('viewBox', '0 0 50 50');

            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.classList.add('path');
            circle.setAttribute('cx', '25');
            circle.setAttribute('cy', '25');
            circle.setAttribute('r', '20');

            const textNode = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            textNode.classList.add('counter');
            textNode.setAttribute('x', '25');
            textNode.setAttribute('y', '30');
            textNode.setAttribute('text-anchor', 'middle');
            textNode.setAttribute('font-size', '12');
            textNode.textContent = '0';

            svg.appendChild(circle);
            svg.appendChild(textNode);
            waitingDiv.appendChild(svg);

            // –¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å–ø–∏–Ω–Ω–µ—Ä–∞
            const generationText = document.createTextNode(' –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞...');
            waitingDiv.appendChild(generationText);

            dialogContainer.appendChild(waitingDiv);
            if (isAtBottom()) {
                dialogContainer.scrollTop = dialogContainer.scrollHeight;
            }

            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –¥–ª—è —Å—á–µ—Ç—á–∏–∫–∞ —Å–µ–∫—É–Ω–¥
            currentTimer = setInterval(() => {
                counter++;
                const lastSvg = dialogContainer.querySelector('.dialog-line-waiting:last-of-type .spinner-svg');
                if (lastSvg) {
                    const textElement = lastSvg.querySelector('text');
                    if (textElement) {
                        textElement.textContent = counter;
                    }
                }
            }, 1000);
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'new_line' –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('new_line', function(data) {
            clearInterval(currentTimer); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            currentTimer = null;

            const lines = dialogContainer.querySelectorAll('.dialog-line-waiting, .dialog-line');
            if (lines.length > 0) {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π div –¥–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
                const completedDiv = document.createElement('div');
                completedDiv.className = 'dialog-line';

                const textPart = document.createTextNode(`${data.step}. ${data.line}`);
                completedDiv.appendChild(textPart);

                // –ó–∞–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É –Ω–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é
                dialogContainer.replaceChild(completedDiv, lines[lines.length - 1]);
            }
            const percentage = (data.step / totalSteps) * 100;
            progressBar.style.width = `${percentage}%`;
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            const hue = (data.step / totalSteps) * 120;
            progressBar.style.background = `linear-gradient(135deg, hsl(${hue}, 70%, 50%) 0%, hsl(${hue - 20 < 0 ? 0 : hue - 20}, 80%, 45%) 100%)`;
            if (isAtBottom()) {
                dialogContainer.scrollTop = dialogContainer.scrollHeight;
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'dialog_completed' –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('dialog_completed', function(data) {
            clearInterval(currentTimer); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
            stepsCount.textContent = data.steps;
            successMessage.style.display = 'block';
            stopButton.disabled = true;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'dialog_stopped' –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('dialog_stopped', function() {
            clearInterval(currentTimer); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            currentTimer = null;

            // –ó–∞–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é
            const lastWaiting = dialogContainer.querySelector('.dialog-line-waiting:last-of-type');
            if (lastWaiting && currentStep && currentSpeaker) {
                const stoppedDiv = document.createElement('div');
                stoppedDiv.className = 'dialog-line';

                const textPart = document.createTextNode(`${currentStep}. ${currentSpeaker}: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`);
                stoppedDiv.appendChild(textPart);

                dialogContainer.replaceChild(stoppedDiv, lastWaiting);
            }

            stopMessage.style.display = 'block';
            progressBar.style.width = '0%';
            stopButton.disabled = true;
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'gpu_status' –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('gpu_status', function(data) {
            gpuMessage.textContent = data.message;
            if (data.status === 'busy') {
                lamp.style.backgroundColor = 'red';
            } else if (data.status === 'free') {
                lamp.style.backgroundColor = 'green';
            } else {
                lamp.style.backgroundColor = 'gray';
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'dialog_error' –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('dialog_error', function(data) {
            errorMessage.innerHTML = '‚ùå ' + data.message;  // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
            errorMessage.style.display = 'block';  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º div –æ—à–∏–±–∫–∏
            stopButton.disabled = true;  // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ç–æ–ø, –ø–æ—Å–∫–æ–ª—å–∫—É –¥–∏–∞–ª–æ–≥ –Ω–µ –Ω–∞—á–∞–ª—Å—è
            clearInterval(currentTimer); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –±—ã–ª –∑–∞–ø—É—â–µ–Ω
        });
    </script>

</body>
</html>



